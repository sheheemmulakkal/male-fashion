<%- include('../includes/userHead.ejs') %>
<%- include('../includes/userNavbar.ejs') %>

<style>
    .main-div{
        display: flex;
        justify-content: center;

    }
    .profile-container {
        /* border: .5px solid #6e6e6e2f; */
        box-shadow: rgba(0, 0, 0, 0.19) 0px 10px 20px, rgba(0, 0, 0, 0.23) 0px 6px 6px;
        /* box-shadow: 0px 10px 40px 0px rgba(56,74,235,0.2); */
    }
    section {
        width: 80%;
    }
    .edit-image{
        text-decoration: none;
    }
    input {
        border-radius: 0!important;
    }
    input.form-control, textarea {
        background-color: #fff;
    }
    input:disabled{
        border: none;
        background-color: #fff;
        font-weight: bold;
    }
    .fs--1 a{
        color: #7a7a7a;
        padding: 10px;
    }

    .fs--1 a.active{
        background-color: #7a7a7a;
        color: #fff;
    }
    
    .fs--1 a:hover {
        background-color: #7a7a7a;
        color: white;
    }
    
</style>
<div class="main-div m-5">
    <section class="font-1">
        <div class="container profile-container p-5">
            <div class="row justify-content-center">
                <div class="col-lg-3">
                    <div class="row font-1">
                        <div class="col text-center text-lg-left">
                            <a href="" data-lightbox="profile-pic">
                                <img class="img-thumbnail radius-primary" src="/images/profile/alt-profile.png" alt="Profile Image" width="150">
                            </a>
                            
                            <h5 class="mb-0 mt-3"><%= user.firstName %> <%= user.lastName %></h5>
                            <p class="mb-0"><%= user.email %></p>
                            <hr class="color-9">
                            <div class="fs--1 fw-600">
                                <a id="orders-link" class=" d-block mb-2" href="/user/orders">Orders</a>
                                <a id="bio-link" class=" d-block mb-2" onclick="editButton()">Edit Bio</a>
                                <a id="addresses-link" class=" d-block mb-2" href="/user/address">Manage Addresses</a>
                                <!-- <a id="password-link" class=" d-block mb-2" href="/user/change-password">Change Password</a> -->
                                <a id="password-link" class=" d-block mb-2" href="/user/wallet">Wallet history</a>
                            </div>                          
                        </div>
                    </div>
                </div>
                <div class="col-md-9 pl-lg-5">
                    <form class="mt-5 row" onsubmit="return validateForm(event)">
                        <div class="col-md-6">
                            <label for="firstName"><b>First Name</b></label>
                            <input class="form-control mb-3" id="firstName" type="text" name="firstName" value="<%= user.firstName %>" disabled placeholder="First Name">
                            <span id="firstNameError" class="error"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="lastName"><b>Last Name</b></label>
                            <input class="form-control mb-3" id="lastName" type="text" name="lastName" value="<%= user.lastName %>" disabled placeholder="Last Name">
                            <span id="lastNameError" class="error"></span>
                        </div>
                        <div class="col-12">
                            <label for="email"><b>Email</b></label>
                            <input class="form-control mb-3" id="email" type="email" name="email" value="<%= user.email %>" disabled placeholder="Email">
                            <span id="emailError" class="error"></span>
                        </div>
                        <div class="col-12">
                            <label for="mobile"><b>Mobile</b></label>
                            <input class="form-control mb-3" id="mobile" type="number" name="mobile" value="<%= user.mobile %>" disabled placeholder="Mobile">
                            <span id="mobileError" class="error"></span>
                        </div>
                        <div id="save" style="display: none;" onclick="update()" class="mt-4 btn btn-dark rounded-0">Save changes</div>
                    </form>
                    <div class="col-12 mt-5">
                        <a style="box-shadow: rgba(0, 0, 0, 0.19) 0px 10px 20px, rgba(0, 0, 0, 0.23) 0px 6px 6px; padding: 25px 50px;margin-inline: 10px;" class="text-primary fw-700">
                             Wallet Balance : â‚¹ <% if( user.wallet) { %><%= user.wallet %><%} else { %>0<% } %>
                        </a>
                        <a href="/user/wallet" style="box-shadow: rgba(0, 0, 0, 0.19) 0px 10px 20px, rgba(0, 0, 0, 0.23) 0px 6px 6px; padding: 25px 50px;margin-inline: 10px;" class="text-success fw-700">
                             Wallet History
                        </a>
                    </div>
                </div>
            </div>
            <!--/.row-->
        </div>
        <div class="wallet">

        </div>
        <!--/.container-->
    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    function editButton() {
        const inp = document.querySelectorAll('.col-md-9 input')
        const save = document.getElementById('save')
        inp.forEach((field) => {
            if (field.getAttribute('name') !== 'email') {
                field.removeAttribute('disabled')
            }
        })
        if (save) {
            save.style.display = 'block'
        }
    }

    async function update() {
        
        const firstName = document.getElementById('firstName').value
        const lastName = document.getElementById('lastName').value
        const mobile = document.getElementById('mobile').value
        const email = document.getElementById('email').value

        console.log(firstName, mobile, lastName, email);

        const response = await axios.put('/user/edit-profile', { firstName, lastName, mobile, email })
        if (response.data.success) {
            const inp = document.querySelectorAll('.col-md-9 input')
            const save = document.getElementById('save')
            inp.forEach((field) => {
                if (field.getAttribute('name') !== 'email') {
                    field.setAttribute('disabled', 'true')
                }
            })
            if (save) {
                save.style.display = 'none'
            }
        }
    }

    function validateForm(event) {
    event.preventDefault(); // Prevent form submission

    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const mobile = document.getElementById('mobile').value.trim();
    const email = document.getElementById('email').value.trim();

    const firstNameError = document.getElementById('firstNameError');
    const lastNameError = document.getElementById('lastNameError');
    const mobileError = document.getElementById('mobileError');
    const emailError = document.getElementById('emailError');

    firstNameError.textContent = '';
    lastNameError.textContent = '';
    mobileError.textContent = '';
    emailError.textContent = '';

    let isValid = true;

    if (firstName === '') {
        firstNameError.textContent = 'First name is required';
        isValid = false;
    } else if (!/^[a-zA-Z]+$/.test(firstName)) {
        firstNameError.textContent = 'First name should only contain letters';
        isValid = false;
    }

    if (lastName === '') {
        lastNameError.textContent = 'Last name is required';
        isValid = false;
    } else if (!/^[a-zA-Z]+$/.test(lastName)) {
        lastNameError.textContent = 'Last name should only contain letters';
        isValid = false;
    }

    if (mobile === '') {
        mobileError.textContent = 'Mobile number is required';
        isValid = false;
    } else if (!/^\d{10}$/.test(mobile)) {
        mobileError.textContent = 'Mobile number should be 10 digits';
        isValid = false;
    }

    if (email === '') {
        emailError.textContent = 'Email is required';
        isValid = false;
    } else if (!/\S+@\S+\.\S+/.test(email)) {
        emailError.textContent = 'Invalid email address';
        isValid = false;
    }

    return isValid;
}



</script>




<%- include('../includes/userFooter.ejs') %>
<%- include('../includes/end.ejs') %>